# è¤‡æ•°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## ğŸ“‹ æ¦‚è¦

è¤‡æ•°ãƒ©ã‚¦ãƒ³ãƒ‰ã«å¯¾å¿œã—ã€ã‚²ãƒ¼ãƒ ã‚’é€£ç¶šã—ã¦ãƒ—ãƒ¬ã‚¤ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

---

## ğŸ¯ å®Ÿè£…æ©Ÿèƒ½

### **1. ãƒ©ã‚¦ãƒ³ãƒ‰é€²è¡Œ**
- Revealãƒ•ã‚§ãƒ¼ã‚ºçµ‚äº†å¾Œã€3ç§’å¾…ã£ã¦ã‹ã‚‰æ¬¡ã®SetPhaseã«è‡ªå‹•é·ç§»
- ãƒ©ã‚¦ãƒ³ãƒ‰ç•ªå·ã‚’+1
- ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ

### **2. ã‚«ãƒ¼ãƒ‰ç®¡ç†**
- SetZoneã®ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤
- ä½¿ç”¨æ¸ˆã¿ã‚«ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒƒã‚­ã«æˆ»ã—ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ«
- å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«1æšãšã¤é…å¸ƒï¼ˆ2æšã«æˆ»ã™ï¼‰

### **3. è¦ªå­äº¤ä»£**
- **1-3ãƒ©ã‚¦ãƒ³ãƒ‰**: Player1ãŒè¦ª
- **4-6ãƒ©ã‚¦ãƒ³ãƒ‰**: Player2ãŒè¦ª
- **7-9ãƒ©ã‚¦ãƒ³ãƒ‰**: Player1ãŒè¦ª
- **10-12ãƒ©ã‚¦ãƒ³ãƒ‰**: Player2ãŒè¦ª
- ...ä»¥é™ç¹°ã‚Šè¿”ã—

### **4. ã‚¹ã‚­ãƒ«ãƒªã‚»ãƒƒãƒˆ**
- ä½¿ç”¨æ¸ˆã‚¹ã‚­ãƒ«ã‚’ã‚¯ãƒªã‚¢
- æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã§å†åº¦ä½¿ç”¨å¯èƒ½ã«

---

## ğŸ› ï¸ å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«

### **ã‚µãƒ¼ãƒãƒ¼å´ (AWS Lambda)**

#### **1. start-game/lambda_function.py**
- **è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: `currentRound`, `currentDealer`
- **åˆæœŸå€¤**: `currentRound=1`, `currentDealer='P1'`

#### **2. next-round/lambda_function.py** (æ–°è¦)
- **æ©Ÿèƒ½**: æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã«é€²ã‚€å‡¦ç†
- **å‡¦ç†å†…å®¹**:
  1. ãƒ©ã‚¦ãƒ³ãƒ‰ç•ªå·ã‚’+1
  2. è¦ªã‚’æ±ºå®šï¼ˆ3ãƒ©ã‚¦ãƒ³ãƒ‰ã”ã¨ã«äº¤ä»£ï¼‰
  3. ä½¿ç”¨æ¸ˆã¿ã‚«ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒƒã‚­ã«æˆ»ã™
  4. ãƒ‡ãƒƒã‚­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  5. å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«1æšé…å¸ƒ
  6. ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ

---

### **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ (Unity)**

#### **1. HttpManager.cs**
- **è¿½åŠ ãƒ¡ã‚½ãƒƒãƒ‰**: `NextRound()`
- **è¿½åŠ ã‚¯ãƒ©ã‚¹**: `NextRoundRequest`, `NextRoundResponse`

#### **2. OnlineGameManager.cs**
- **è¿½åŠ ãƒ¡ã‚½ãƒƒãƒ‰**:
  - `WaitAndProceedToNextRound()`: 3ç§’å¾…æ©Ÿ
  - `StartNextRound()`: ã‚µãƒ¼ãƒãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
  - `OnNextRoundSuccess()`: æˆåŠŸæ™‚ã®å‡¦ç†
  - `OnNextRoundError()`: ã‚¨ãƒ©ãƒ¼å‡¦ç†
  - `ClearSetZone()`: SetZoneã®ã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤

---

## ğŸ“Š å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
ã€Reveal Phaseçµ‚äº†ã€‘
  â†“
å‹æ•—è¡¨ç¤ºï¼ˆResultViewï¼‰
  â†“
3ç§’å¾…æ©Ÿ
  â†“
OnlineGameManager.StartNextRound()
  â†“
HttpManager.NextRound() â†’ Lambdaé–¢æ•°å‘¼ã³å‡ºã—
  â†“
ã€Lambda: next-roundã€‘
  â”œâ”€ ãƒ©ã‚¦ãƒ³ãƒ‰+1
  â”œâ”€ è¦ªæ±ºå®š
  â”œâ”€ ä½¿ç”¨æ¸ˆã‚«ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒƒã‚­ã«æˆ»ã™
  â”œâ”€ ãƒ‡ãƒƒã‚­ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  â”œâ”€ ã‚«ãƒ¼ãƒ‰é…å¸ƒ
  â””â”€ DynamoDBæ›´æ–°
  â†“
OnlineGameManager.OnNextRoundSuccess()
  â”œâ”€ ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿æ›´æ–°
  â”œâ”€ æ‰‹æœ­å†è¨­å®š
  â”œâ”€ SetZoneã‚¯ãƒªã‚¢
  â”œâ”€ ã‚¹ã‚­ãƒ«ãƒªã‚»ãƒƒãƒˆ
  â””â”€ ãƒ•ã‚§ãƒ¼ã‚ºç›£è¦–å†é–‹
  â†“
ã€Set Phaseé–‹å§‹ã€‘
```

---

## ğŸ”§ è¦ªæ±ºå®šãƒ­ã‚¸ãƒƒã‚¯

```python
# Lambdaé–¢æ•°å†…
if ((next_round - 1) // 3) % 2 == 0:
    new_dealer = 'P1'
else:
    new_dealer = 'P2'
```

**è¨ˆç®—ä¾‹:**
| ãƒ©ã‚¦ãƒ³ãƒ‰ | `(round-1)//3` | `%2` | è¦ª |
|---------|---------------|------|-----|
| 1 | 0 | 0 | P1 |
| 2 | 0 | 0 | P1 |
| 3 | 0 | 0 | P1 |
| 4 | 1 | 1 | P2 |
| 5 | 1 | 1 | P2 |
| 6 | 1 | 1 | P2 |
| 7 | 2 | 0 | P1 |
| 8 | 2 | 0 | P1 |
| 9 | 2 | 0 | P1 |

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### **Step 1: start-game Lambdaæ›´æ–°**

æ—¢å­˜ã®Lambdaé–¢æ•°ã‚’æ›´æ–°ï¼ˆ`currentRound`, `currentDealer`è¿½åŠ ï¼‰

```powershell
cd lambda-functions/start-game
aws lambda update-function-code --function-name start-game --zip-file fileb://function.zip
```

### **Step 2: next-round Lambdaä½œæˆ**

```powershell
cd lambda-functions/next-round
.\deploy.ps1
```

### **Step 3: API Gatewayè¨­å®š**

1. **POST /next-round ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä½œæˆ**
2. **Lambdaçµ±åˆ**: `next-round`é–¢æ•°ã‚’é¸æŠ
3. **CORSæœ‰åŠ¹åŒ–**
4. **APIãƒ‡ãƒ—ãƒ­ã‚¤**

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ‰‹é †

### **1. 1ãƒ©ã‚¦ãƒ³ãƒ‰ç›®ãƒ—ãƒ¬ã‚¤**
- SetPhase: ã‚«ãƒ¼ãƒ‰é…ç½®
- BettingPhase: ãƒ™ãƒƒãƒˆ
- RevealPhase: å‹æ•—è¡¨ç¤º

### **2. è‡ªå‹•é·ç§»ç¢ºèª**
- Revealè¡¨ç¤ºå¾Œ3ç§’å¾…æ©Ÿ
- è‡ªå‹•çš„ã«SetPhaseã«æˆ»ã‚‹

### **3. ã‚«ãƒ¼ãƒ‰çŠ¶æ…‹ç¢ºèª**
- SetZoneãŒç©ºã«ãªã£ã¦ã„ã‚‹
- æ‰‹æœ­ãŒ2æšã«ãªã£ã¦ã„ã‚‹
- ã‚¹ã‚­ãƒ«ãƒœã‚¿ãƒ³ãŒä½¿ç”¨å¯èƒ½ã«ãªã£ã¦ã„ã‚‹

### **4. è¦ªäº¤ä»£ç¢ºèª**
- 4ãƒ©ã‚¦ãƒ³ãƒ‰ç›®ã§è¦ªãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹

---

## ğŸ“ ãƒ­ã‚°ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

### **Unity Console:**
```
[OnlineGameManager] Waiting 3 seconds before next round...
[OnlineGameManager] Proceeding to next round
[OnlineGameManager] Next round success: Round 2, Dealer: P1
[OnlineGameManager] My SetZone cleared
[OnlineGameManager] Opponent SetZone cleared
[OnlineGameManager] Next round setup complete - Round 2
```

### **Lambda CloudWatch:**
```
Game game_xxx: Advancing from round 1 to 2
Round 2: Dealer is P1
Used cards this round: [5, 12]
Deck shuffled. Deck size: 50
Cards dealt. Player1: [3, 8], Player2: [15, 22]
Game state updated for round 2
```

---

## âš ï¸ æ³¨æ„äº‹é …

1. **SetZoneã®GameObjectå**
   - `MySetZone`
   - `OpponentSetZone`
   - ã“ã‚Œã‚‰ã®åå‰ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

2. **ãƒ‡ãƒƒã‚­æšæ•°**
   - 52æšãƒ‡ãƒƒã‚­ã‚’æƒ³å®š
   - é•·æœŸæˆ¦ã«ãªã‚‹ã¨ã‚«ãƒ¼ãƒ‰ä¸è¶³ã®å¯èƒ½æ€§
   - å¿…è¦ã«å¿œã˜ã¦ãƒ‡ãƒƒã‚­å†ç”Ÿæˆå‡¦ç†ã‚’è¿½åŠ 

3. **ãƒ©ã‚¤ãƒ•ãƒã‚¤ãƒ³ãƒˆ**
   - ç¾åœ¨ã¯æ¸›ã‚‰ãªã„ä»•æ§˜
   - å‹æ•—åˆ¤å®šã§ãƒ©ã‚¤ãƒ•ã‚’æ¸›ã‚‰ã™å‡¦ç†ã¯åˆ¥é€”å®Ÿè£…

---

## ğŸ® ä»Šå¾Œã®æ‹¡å¼µ

- [ ] ãƒ©ã‚¤ãƒ•ãƒã‚¤ãƒ³ãƒˆæ¸›å°‘å‡¦ç†
- [ ] ã‚²ãƒ¼ãƒ çµ‚äº†åˆ¤å®šï¼ˆãƒ©ã‚¤ãƒ•0ï¼‰
- [ ] ãƒ©ã‚¦ãƒ³ãƒ‰æ•°åˆ¶é™
- [ ] ãƒªã‚¶ãƒ«ãƒˆç”»é¢ï¼ˆæœ€çµ‚çµæœï¼‰
- [ ] ãƒªãƒ—ãƒ¬ã‚¤æ©Ÿèƒ½

---

**ä½œæˆæ—¥:** 2025-10-10  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** å®Ÿè£…å®Œäº†ï¼ˆãƒ†ã‚¹ãƒˆå¾…ã¡ï¼‰


